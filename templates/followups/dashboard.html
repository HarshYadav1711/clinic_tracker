{% extends "base.html" %}

{% block content %}
<h2>Dashboard</h2>

<p>
    Total: {{ total }} |
    Pending: {{ pending }} |
    Done: {{ done }}
</p>

<p>
    <a href="{% url 'followup_create' %}">Create new follow-up</a>
</p>

<form method="get" style="margin-bottom: 20px;">
    Status:
    <select name="status">
        <option value="">All</option>
        <option value="pending" {% if request.GET.status == "pending" %}selected{% endif %}>Pending</option>
        <option value="done" {% if request.GET.status == "done" %}selected{% endif %}>Done</option>
    </select>

    From:
    <input type="date" name="from" value="{{ request.GET.from }}">

    To:
    <input type="date" name="to" value="{{ request.GET.to }}">

    <button type="submit">Filter</button>
</form>

<table border="1" cellpadding="5">
    <tr>
        <th>Patient</th>
        <th>Phone</th>
        <th>Due Date</th>
        <th>Status</th>
        <th>Language</th>
        <th>Views</th>
        <th>Public Link</th>
        <th>Actions</th>
    </tr>

    {% for f in followups %}
    <tr>
        <td>{{ f.patient_name }}</td>
        <td>{{ f.phone }}</td>
        <td>{{ f.due_date }}</td>
        <td>{{ f.status }}</td>
        <td>{{ f.language }}</td>
        <td>{{ f.publicviewlog_set.count }}</td>
        <td>
            <a href="{% url 'public_view' f.public_token %}" target="_blank">
                Open
            </a>
        </td>
        <td>
            <a href="{% url 'followup_edit' f.id %}">Edit</a>

            {% if f.status != "done" %}
            <form method="post" action="{% url 'mark_done' f.id %}" style="display:inline;">
                {% csrf_token %}
                <button type="submit">Mark Done</button>
            </form>
            {% endif %}
        </td>
    </tr>
    {% empty %}
    <tr>
        <td colspan="7">No follow-ups found.</td>
    </tr>
    {% endfor %}
</table>
{% endblock %}